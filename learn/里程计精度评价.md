# 里程计精度评价

## 一. 实现方法

一共分两步进行：存数据和评价

### 1. 数据存储

我们在发布里程计的函数PublishData前面再加一个函数SaveTrajectory去存储数据就好。

自然需要的就是创建文件夹，创建txt文件，往文件里写数据。

```cpp
bool FrontEndFlow::SaveTrajectory(){
    static std::ofstream ground_truth, laser_odom;
    static bool is_file_created = false;
    if(!is_file_created){
        if(!FileManager::CreateDirectory(WORK_SPACE_PATH + "/slam_data/trajecroty"))
            return false;
        if(!FileManager::CreateFile(ground_truth, WORK_SPACE_PATH + "/slam_data/trajectory/ground_truth.txt"))
            return false;
        if(!FileManager::CreatFile(laser_odom, WORK_SPACE_PATH + "/slam_data/trajectory/laser_odom.txt"))
            return false;
        is_file_created = true;
    }
    
    for(int i = 0; i < 3; ++i){
        for(int j = 0; j < 4; ++j){
            ground_truth << gnss_odometry_(i, j);
            laser_odom << laser_odometry_(i, j);
            if(i == 2 && j == 3){
                ground_truth << std::endl;
                laser_odom << std::endl;
            }else{
                ground_truth << "  ";
                laser_odom << "  ";
            }
        }
    }
    
    return true;
}
```

由于创建文件夹和创建文件这类功能是通用功能，所以我们在工程目录tools文件夹下定义一个FileManager类，专门存放此类小功能。

其中此处两个功能对应的函数分别是CreateDirectory和CreatFile。

存数据就是往txt文件里写两个位姿矩阵。

**file_manager.hpp**

```cpp
#ifndef LIDAR_LICALIZATION_TOOLS_FILE_MANAGER_HPP
#define LIDAR_LICALIZATION_TOOLS_FILE_MANAGER_HPP

#include <string>
#include <iostream>
#include <fstream>

namespace lidar_localization{
    class FileManager{
        public:
        static bool CreateFile(std::ofstream& ofs, std::string file_path);
        static bool CreateDirectory(std::string directory_path);
    };
}

#endif
```

**file_manager.cpp**

```cpp
#include "lidar_localization/tools/file_manager.hpp"

#include <boost/filesystem.hpp>
#include "glog/logging.h"

namespace lidar_localization{
    bool FileManager::CreatFile(std::ofstram& ofs, std::string file_path){
        ofs.open(file_path.c_str(), std::ios::app)
        if(!ofs){
            LOG(WARNING)<<"无法生成文件"<<file_path;
            return false;
        }
        return true;
    }
    
    bool FileManager::CreatDirectory(std::string directory_path){
        
    }
}
```

